# Bothelp Demo

Демонстрационный проект для Bothelp.

## Запуск

  1. Склонировать репозиторий
  ```
git clone https://github.com/Nex-Otaku/bothelp-demo.git
```
  2. Запустить проект
  ```
cd bothelp-demo
make build
make up
```

## Задача

Есть веб-api, непрерывно принимающее события (ограничимся 10000 событий) для группы аккаунтов (1000 аккаунтов) и складывающее их в очередь.
Каждое событие связано с определенным аккаунтом и важно, чтобы события аккаунта обрабатывались в том же порядке, в котором поступили в очередь.
Обработка события занимает 1 секунду (эмулировать с помощью sleep).

Веб-api и очередь эмулировать консольным скриптом, непрерывно генерирующим события для обработки в фоне. События генерировать пачками, содержащими последовательности по 1-10 для каждого аккаунта.
Сделать обработку очереди событий максимально быстрой на данной конкретной машине.

Код писать на PHP. Можно использовать фреймворки и инструменты такие как RabbitMQ, Redis, MySQL и т. д. Запуск кода сделать в 1-3 команды, поэтому при необходимости использовать docker и docker-compose.

На выходе нужен лог с id аккаунтов и id событий для проверки очередности выполнения событий.

## Концепция решения

Поступающие события записываются в Redis.

Воркеры разбирают события из Redis. Для гарантии, что события по одному аккаунту будут выполняться упорядоченно,
мы используем блокировку по ID аккаунта. Таким образом, каждый аккаунт может в любой момент обрабатываться только одним воркером.

Для того чтобы ускорить обработку, запускаем побольше воркеров. Чем больше воркеров, тем быстрее разбирается очередь.
Максимальная скорость возможна при количестве воркеров, чуть выше количества одновременно обрабатываемых аккаунтов.
